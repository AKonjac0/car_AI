import torch
import clip
from clip import tokenize
import glob, json
import cv2
from PIL import Image
import numpy as np
import Yolo_v8 as yl

device = "cuda" if torch.cuda.is_available() else "cpu"
model, transforms = clip.load("ViT-B/32", device=device)
# model, transforms = load_model("ViT_B_32", pretrained=True)
print("model loaded")
en_match_words = {
    "scerario": ["city road", "express-way", "suburbs", "parking-lot"],
    "weather": ["clear", "cloudy", "raining", "foggy", "snowy", "unknown"],
    "period": ["daytime", "dawn or dusk", "night", "unknown"],
    "road_structure": ["normal", "crossroads", "T-junction", "ramp", "lane merging", "parking lot entrance",
                       "round about", "unknown"],
    "general_obstacle": ["nothing", "speed bumper", "traffic cone", "water horse", "stone", "manhole cover", "nothing",
                         "unknown"],
    "abnormal_condition": ["uneven", "oil or water stain", "standing water", "cracked", "nothing", "unknown"],
    "ego_car_behavior": ["slow down", "go straight", "turn right", "turn left", "stop", "U-turn", "speed up",
                         "lane change", "others"],
    "closest_participants_type": ["passenger car", "bus", "truck", "nothing",
                                  "unknown"],
    "closest_participants_behavior": ["slow down", "go straight", "turn right", "turn left", "stop", "U-turn",
                                      "speed up", "lane change", "others"],
}

submit_json = {
    "author": "AKonjac_",
    "time": "231116",
    "model": "clip ViT_L/14@336px",
    "test_results": []
}

paths = glob.glob('./test/*')
paths.sort()

def multi_detect():
    for keyword in en_match_words.keys():
        if keyword not in ["weather", "scerario"]:
            continue
        print(keyword)
        cap = cv2.VideoCapture(video_path)
        texts = np.array(en_match_words[keyword])

        ret, frame = cap.read()
        image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
        image = Image.fromarray(image)
        image = transforms(image).unsqueeze(0).to(device)
        with torch.no_grad():
            logits_per_image, logits_per_text = model(image, tokenize(en_match_words[keyword]).to(device))
            probs = logits_per_image.softmax(dim=-1).cpu().numpy()

        cnt = 0
        tot = 0
        while cap.isOpened():
            ret, frame = cap.read()
            if ret == False:
                break

            cnt += 1

            if cnt == 24:
                cnt = 0
                tot += 1
                if tot >= 10:
                    break
                image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
                image = Image.fromarray(image)
                image = transforms(image).unsqueeze(0).to(device)
                with torch.no_grad():
                    logits_per_image, logits_per_text = model(image, tokenize(en_match_words[keyword]).to(device))
                    tmps = logits_per_image.softmax(dim=-1).cpu().numpy()[0]
                    i = 0
                    for tmp in tmps:
                        if tmps[i] > probs[0][i]:
                            probs[0][i] = tmps[i]
                        i += 1
        if keyword == "scerario":
            if probs[0][3] < 0.95:
                probs[0][3] = 0
            if probs[0][2] < 0.41:
                probs[0][2] = 0
            '''if probs[0][1] < 0.5:
                probs[0][1] = 0
           '''
        print(probs[0])
        single_video_result[keyword] = texts[probs[0].argsort()[::-1][0]]
        print(single_video_result[keyword])


def mid_frame():
    cnt = 0
    tmp = []
    cap = cv2.VideoCapture(video_path)
    while cap.isOpened():
        ret, frame = cap.read()
        if ret == 0:
            break
        cnt += 1
        image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
        image = Image.fromarray(image)
        image = transforms(image).unsqueeze(0).to(device)
        tmp.append(image)
    return tmp[int(cnt / 2)]


for video_path in paths:
    print(video_path)
    # if video_path not in[r"./test\48.avi",r"./test\49.avi",r"./test\50.avi",r"./test\03.avi",r"./test\04.avi",r"./test\08.avi",r"./test\21.avi",r"./test\36.avi",r"./test\35.avi",r"./test\43.avi"]:
    #     continue
    clip_id = video_path.split('/')[-1]
    single_video_result = {
        "clip_id": clip_id,
        "scerario": "city street",
        "weather": "clear",
        "period": "daytime",
        "road_structure": "normal",
        "general_obstacle": "nothing",
        "abnormal_condition": "nothing",
        "ego_car_behavior": "go straight",
        "closest_participants_type": "passenger car",
        "closest_participants_behavior": "go straight"
    }
    '''cap = cv2.VideoCapture(video_path)
    ret, frame = cap.read()
    image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    image = Image.fromarray(image)
    image = transforms(image).unsqueeze(0).to(device)

    for keyword in en_match_words.keys():
        if keyword not in ["weather", "scerario"]:
            continue
        texts = np.array(en_match_words[keyword])
        with torch.no_grad():
            logits_per_image, logits_per_text = model(image, tokenize(en_match_words[keyword]).to(device))
            probs = logits_per_image.softmax(dim=-1).cpu().numpy()
        single_video_result[keyword] = texts[probs[0].argsort()[::-1][0]]'''
    multi_detect()
        # single_video_result["closest_participants_type"] = yl.yolo(video_path)
    submit_json["test_results"].append(single_video_result)

with open('clip_result_10.json', 'w', encoding='utf-8') as up:
    json.dump(submit_json, up, ensure_ascii=False)

'''

model loaded
./test\03.avi
scerario
[   0.093064    0.060455     0.49416     0.39224    0.016163]
[   0.093064    0.062075     0.51059     0.39224    0.017002]
[   0.093064    0.062075     0.59397     0.39224    0.019201]
[   0.093064    0.062075     0.59397     0.39224    0.028707]
[   0.093064    0.062075     0.59397     0.39224    0.028707]
[   0.093064    0.077909     0.59397     0.39224    0.028707]
[   0.093064    0.077909      0.6006     0.39224    0.028707]
[   0.093064    0.077909     0.64796     0.39224    0.028707]
[   0.093064    0.092349     0.64796     0.39224    0.028707]
weather
[   0.024379    0.021974    0.004512   0.0097232     0.95406     0.01115]
[   0.024379    0.024093    0.004512   0.0097232     0.95406     0.01115]
[   0.024379    0.025003    0.004512   0.0097232     0.95406     0.01115]
[   0.024379    0.025003   0.0049136   0.0097232     0.95406    0.012118]
[    0.02766    0.025003   0.0049136   0.0097232     0.95406    0.012118]
[    0.02766    0.025003   0.0059352   0.0097232     0.95406    0.012118]
[    0.02766    0.025003   0.0059352    0.011053     0.95406    0.012118]
[    0.02766    0.025003   0.0087489    0.012831     0.95406    0.012118]
[    0.02766    0.025003   0.0087489    0.012831     0.95507    0.012118]
./test\04.avi
scerario
[    0.10408     0.09696     0.46841     0.34716    0.030186]
[    0.10408     0.09696     0.53322     0.34716    0.033003]
[    0.10408     0.09696     0.65695     0.34716    0.033003]
[    0.10408     0.09696     0.67775     0.34716    0.033003]
[    0.10408     0.09696     0.70923     0.34716    0.033003]
[    0.10408     0.09696     0.70923     0.37181    0.033003]
[    0.10408     0.11275     0.70923     0.45914    0.033003]
[    0.22522     0.17967     0.70923     0.45914    0.035721]
[    0.22522     0.17967     0.70923     0.45914    0.050016]
weather
[   0.022769    0.019032   0.0039987   0.0091965     0.96029    0.010898]
[   0.022769    0.019032   0.0039987     0.00937     0.96029    0.010898]
[   0.022769    0.023826   0.0039987    0.012051     0.96029    0.010898]
[   0.022769    0.023826   0.0039987    0.012051     0.96029    0.010898]
[   0.022769    0.024258   0.0050018    0.012051     0.96029    0.010898]
[   0.022769    0.024258   0.0050018     0.02093     0.96029    0.010898]
[   0.022769    0.024258   0.0050018     0.02093     0.96029    0.010898]
[   0.022769    0.024258   0.0050018     0.02093     0.96029    0.010898]
[   0.043394    0.024258    0.007675     0.02093     0.96029    0.019978]
./test\08.avi
scerario
[    0.18985     0.33364     0.34246     0.42024    0.032561]
[    0.18985     0.33364     0.34246     0.55212    0.032561]
[    0.18985     0.33364     0.34246     0.84757    0.032561]
[    0.18985     0.33364     0.34246     0.88397    0.032561]
[    0.18985     0.33364     0.34246     0.90207    0.032561]
[    0.18985     0.33364     0.34246     0.90207    0.055304]
[    0.18985     0.33364     0.34246     0.90207    0.055304]
[    0.18985     0.33364     0.34246     0.90207     0.61781]
[    0.18985     0.33364     0.50484     0.90207     0.61781]
weather
[   0.017595    0.010563   0.0026271   0.0023449     0.96157    0.015864]
[   0.062329     0.11261   0.0071633    0.019321     0.96157    0.015864]
[   0.062329     0.11261   0.0071633     0.03408     0.96157    0.015864]
[   0.062329     0.11261   0.0071633     0.03408     0.96356    0.015864]
[   0.062329     0.11261   0.0071633    0.057999     0.96356    0.015864]
[   0.082021     0.11261   0.0071633    0.057999     0.96356    0.015864]
[    0.28291     0.11261   0.0071633    0.057999     0.96356    0.016112]
[    0.28291     0.11261    0.033486    0.057999     0.96356     0.11548]
[    0.28291     0.11261    0.033486    0.057999     0.96356     0.11548]
./test\10.avi
scerario
[    0.22897     0.45167     0.21557     0.41647    0.012565]
[    0.23025     0.45167     0.21557     0.48775    0.012565]
[    0.23025     0.45167     0.21785     0.48775    0.012565]
[    0.34961     0.45167     0.30186     0.48775    0.014056]
[    0.34961     0.45167     0.30186     0.48775    0.028349]
[    0.34961     0.45167     0.30186     0.48775    0.028349]
[    0.34961     0.45167     0.30186     0.48775    0.028349]
[    0.34961     0.45167     0.30186     0.48775    0.028349]
[    0.34961     0.45167     0.30186     0.48775    0.028349]
weather
[    0.36544     0.14802      0.2805     0.23341    0.024688     0.18182]
[    0.36544     0.24615      0.2805     0.23341    0.024688     0.18182]
[    0.36544     0.24615      0.2805     0.24866    0.024688     0.18182]
[    0.36544     0.24615      0.2805     0.28649    0.024688     0.18182]
[    0.36544     0.24615      0.2805     0.28649    0.024688     0.19185]
[    0.36544     0.24615     0.32522     0.28649    0.024688     0.19185]
[    0.36544     0.24615     0.32522     0.28649    0.024688     0.19185]
[    0.36544     0.24615     0.34958     0.28649    0.024688     0.19185]
[    0.37217     0.24615     0.34958     0.28649    0.024688     0.19185]
./test\11.avi
scerario
[    0.39082     0.28099     0.26106      0.2209    0.016625]
[    0.43879     0.28099     0.26106      0.2209    0.018856]
[    0.43879     0.28099     0.26106      0.2209    0.018856]
[    0.43879     0.28099     0.29099      0.2209    0.018856]
[    0.43879     0.28099     0.29099      0.2209    0.018856]
[    0.43879     0.28099     0.29099      0.2209    0.018856]
[    0.43879     0.28099     0.29099      0.2209    0.019936]
[    0.43879     0.28099     0.29099      0.2209    0.019936]
[    0.43879     0.28099     0.35286      0.2209    0.038385]
weather
[ 0.00053773   0.0046613     0.01683     0.98463  0.00052851  0.00033013]
[ 0.00053773   0.0046613     0.01683     0.98463  0.00052851  0.00033013]
[ 0.00053773   0.0047574    0.034217     0.98463  0.00055522  0.00034676]
[ 0.00089933    0.005586    0.034217     0.98463  0.00055522  0.00034676]
[ 0.00089933   0.0068314    0.034217     0.98463    0.001419  0.00038568]
[ 0.00089933     0.00733    0.034217     0.98463    0.001419  0.00038568]
[ 0.00096944     0.00733    0.034217     0.98463    0.001419  0.00052753]
[  0.0010277   0.0090779    0.034217     0.98463    0.001419  0.00052753]
[  0.0010874   0.0090779    0.034217     0.98463    0.001419  0.00052753]
./test\12.avi
scerario
[    0.39725    0.070064    0.063571     0.59414   0.0071355]
[    0.39725    0.070064     0.18856     0.59414   0.0089156]
[    0.47242    0.070064     0.18856     0.59414   0.0089156]
[    0.47242    0.070064     0.18856     0.81115   0.0089156]
[    0.47242    0.070064     0.18856     0.81115   0.0089156]
[    0.47242    0.070064     0.18856     0.81115   0.0089156]
[    0.47242    0.070064     0.24882     0.81115    0.017825]
[    0.47242    0.070064     0.24882     0.81115    0.017825]
[    0.47242    0.070064     0.24882     0.81115    0.017825]
weather
[   0.028418     0.11773     0.75504     0.21246     0.00686    0.016552]
[   0.028418     0.11773     0.80403     0.21246     0.00686    0.016552]
[   0.028418     0.11773     0.80403     0.23994     0.00686    0.016552]
[     0.0288     0.11773     0.80403     0.23994     0.00686    0.016552]
[     0.0288     0.11773     0.80403     0.23994     0.00686    0.016552]
[     0.0288     0.11773     0.80403     0.23994    0.010892    0.016552]
[     0.0288     0.11773     0.80403     0.23994    0.010892    0.016552]
[   0.034668     0.11773     0.80403     0.23994    0.010892    0.016552]
[   0.034668     0.15225     0.80403     0.23994    0.010892    0.028854]
./test\21.avi
scerario
[   0.085618    0.016796     0.92155   0.0070164  0.00047093]
[    0.14064    0.054454     0.92155    0.026151  0.00080121]
[    0.14064     0.20314     0.92155    0.033894  0.00080121]
[    0.14064     0.20314     0.92155    0.068711   0.0011991]
[    0.14064     0.20314     0.92155    0.068711   0.0011991]
[    0.14064     0.20314     0.93958    0.068711   0.0011991]
[    0.14064     0.20314     0.93958    0.068711   0.0011991]
[    0.14064     0.20314     0.94718    0.068711   0.0011991]
weather
[    0.16949     0.53492    0.084933     0.22631    0.015858    0.041001]
[    0.16949     0.53492    0.084933     0.31586    0.015858    0.041001]
[    0.16949     0.65951    0.084933     0.31586    0.015858    0.041001]
[    0.16949     0.65951    0.084933     0.34187    0.015858    0.041001]
[    0.17197     0.65951    0.084933     0.34187    0.015858    0.041001]
[    0.17197     0.65951    0.084933     0.34187    0.015858    0.041001]
[    0.17197     0.65951    0.084933     0.34187    0.015858    0.041001]
[    0.17197     0.69735    0.084933     0.34187    0.015858    0.041001]
./test\22.avi
scerario
[    0.36167     0.14407     0.24705     0.26924    0.015288]
[    0.36167     0.15695     0.24705     0.26924    0.015288]
[    0.36167     0.17727     0.24705     0.26924    0.015288]
[    0.36167     0.17727     0.27922     0.26924    0.015288]
[    0.36167     0.17727     0.35634     0.26924    0.036077]
[    0.36167     0.17727     0.35634     0.33814    0.036077]
[    0.36167     0.17727     0.47976     0.33814    0.036077]
[    0.36167     0.17727     0.47976     0.33814    0.036077]
[    0.36167     0.17727     0.47976     0.33814    0.036077]
weather
[    0.35486    0.041895    0.069767     0.22611    0.059535     0.36335]
[    0.35486    0.041895    0.069767     0.22611    0.059535     0.37908]
[    0.35486    0.045141    0.069767     0.22611    0.094742     0.37908]
[    0.35486    0.050978    0.096505     0.22611    0.094742     0.37908]
[    0.35778    0.050978    0.096505     0.22611    0.094742     0.37908]
[    0.35778    0.050978     0.14032     0.22611     0.24816     0.37908]
[    0.44154    0.050978     0.14032     0.22611     0.24816     0.37908]
[    0.44154    0.052707     0.14032     0.22611     0.24816     0.37908]
[    0.44154    0.052707     0.14032     0.22611     0.24816     0.38675]
./test\23.avi
scerario
[    0.15241     0.52992     0.37031    0.031058   0.0043898]
[     0.2306     0.52992     0.38409    0.076326   0.0084653]
[     0.2306     0.52992     0.38409    0.076326   0.0084653]
[    0.42714     0.52992     0.38409     0.12659   0.0084653]
[    0.42714     0.52992      0.6555     0.12659   0.0084653]
[    0.42714     0.52992      0.6555     0.12833   0.0084653]
[    0.42714     0.52992     0.78506     0.12833   0.0084653]
[    0.42714     0.52992     0.80029     0.12833   0.0084653]
weather
[    0.73842     0.13396    0.079695    0.058252   0.0057168      0.1209]
[    0.73842     0.13396    0.079695     0.06451   0.0085786      0.1209]
[    0.73842     0.13396     0.10373     0.12505   0.0099063     0.12737]
[    0.73842     0.13396     0.10373     0.17213    0.010555     0.12737]
[    0.73842     0.13396     0.10373     0.22554    0.010555     0.12737]
[    0.82269     0.13396     0.10373     0.22554    0.010555     0.12737]
[    0.82269     0.13396     0.10373     0.22554    0.010555     0.12905]
[    0.82269     0.13396     0.10373     0.22554    0.010555     0.12905]
./test\24.avi
scerario
[   0.092601     0.24479     0.59748      0.1153   0.0061964]
[   0.092601     0.24479     0.70046      0.1153   0.0061964]
[    0.28596     0.28804     0.70046     0.15111   0.0061964]
[    0.28596     0.28804     0.70046     0.15111   0.0061964]
[    0.28596     0.28804     0.76635     0.15111   0.0082776]
[    0.28596     0.28809     0.76635     0.21358    0.011171]
[    0.28596     0.34221     0.76635     0.21358    0.011171]
[    0.28596     0.34221     0.76635     0.21358    0.011171]
[    0.28596     0.34221     0.76635     0.21358    0.011171]
weather
[   0.001803    0.018236    0.055441     0.95319  0.00045962   0.0013125]
[  0.0035057    0.032073    0.055441     0.95319  0.00045962   0.0013125]
[  0.0035057    0.032073    0.055441     0.97876  0.00045962   0.0013125]
[  0.0035057    0.032073    0.055978     0.97876  0.00045962   0.0013125]
[  0.0085617    0.032073     0.15565     0.97876   0.0016749   0.0014883]
[  0.0085617    0.032073     0.15565     0.97876   0.0016749   0.0014883]
[  0.0085617    0.032073     0.15565     0.97876   0.0016749   0.0014883]
[  0.0085617    0.032073     0.15565     0.97876   0.0016749   0.0014883]
[  0.0085617    0.032073     0.15565     0.97876   0.0016749   0.0014883]
./test\25.avi
scerario
[    0.21141     0.36765     0.16622     0.28263    0.012179]
[    0.25536     0.36765     0.16622     0.33756    0.012179]
[    0.27821     0.36765     0.16622     0.33756    0.012179]
[    0.27821     0.39874     0.16622     0.33756    0.012179]
[    0.27821     0.39874     0.16622     0.40976    0.012179]
[    0.27821     0.39874     0.16622     0.65369    0.012179]
[    0.27821     0.39874     0.16622     0.77434    0.012179]
[    0.32172     0.39874     0.16622     0.77434    0.012179]
[    0.32172     0.39874     0.16622     0.77434    0.012179]
weather
[   0.061466    0.033918   0.0062311     0.01659      0.8937    0.012436]
[   0.061466     0.04036   0.0076404    0.034103      0.8937    0.012436]
[   0.061466     0.04036   0.0087527    0.034103      0.8937    0.012436]
[   0.061466     0.04036   0.0087527    0.034103      0.8937    0.012436]
[   0.061466     0.04036     0.01535     0.03605      0.8937    0.012436]
[   0.061466    0.044286     0.01535    0.080582      0.8937    0.012436]
[   0.061466    0.060094    0.022131    0.080582      0.8937    0.012436]
[   0.061466     0.12685    0.030064     0.11572      0.8937    0.012436]
[   0.061466     0.12685    0.030064     0.11572      0.8937    0.012436]
./test\31.avi
scerario
[    0.62019    0.077411    0.051815     0.35882   0.0016049]
[    0.62019    0.077411    0.051815     0.35882   0.0016826]
[    0.62019    0.077411    0.051815     0.40253   0.0016826]
[    0.74551    0.081159    0.051815     0.40253   0.0016826]
[     0.7737      0.1139    0.071284     0.40253   0.0037874]
[     0.7737     0.27661     0.10923     0.40253   0.0037874]
[     0.7737     0.27661     0.28643     0.40253   0.0037874]
[     0.7737     0.27661     0.28643     0.40253   0.0037874]
[     0.7737     0.27661     0.28643     0.40253   0.0037874]
weather
[  0.0063075   0.0069995   0.0038493    0.037565     0.95293   0.0010242]
[  0.0063075   0.0069995   0.0061704     0.03821     0.95293   0.0010242]
[  0.0063075   0.0069995   0.0091059    0.065893     0.95293   0.0010242]
[  0.0063075   0.0092016   0.0091059    0.065893     0.95293   0.0010242]
[  0.0063075   0.0092016   0.0091059    0.065893     0.95293   0.0010242]
[  0.0063075   0.0092016   0.0091059    0.065893     0.95293   0.0010242]
[  0.0063075   0.0092016   0.0091059    0.065893     0.96255   0.0010242]
[  0.0063075    0.010969   0.0091059    0.065893     0.96255   0.0010242]
[  0.0097066    0.016732   0.0091059    0.065893     0.96255   0.0010242]
./test\35.avi
scerario
[   0.085347    0.061636     0.88366    0.048643   0.0041951]
[    0.09548    0.092018     0.88366    0.068355   0.0062989]
[    0.09548    0.092018     0.88366     0.12616   0.0062989]
[     0.3867     0.11835     0.88366      0.1532   0.0062989]
[     0.3867     0.16729     0.88366     0.15982   0.0062989]
[     0.3867     0.16729     0.88366     0.15982   0.0062989]
[     0.3867     0.16729     0.88366     0.15982   0.0062989]
[     0.3867     0.16729     0.88366     0.15982   0.0062989]
[     0.3867     0.16729     0.88366     0.15982   0.0062989]
weather
[   0.010982   0.0071786    0.022001    0.039229     0.93548   0.0011086]
[   0.013181   0.0071786    0.022001    0.039229     0.93863   0.0011086]
[   0.013181   0.0071786    0.022001    0.039229     0.93863   0.0011212]
[   0.013181   0.0071786    0.022001    0.049447     0.93863   0.0015057]
[   0.013181   0.0071786    0.022001    0.062737     0.93863   0.0015057]
[   0.013181   0.0071786    0.022001    0.065497     0.93863   0.0015057]
[   0.013181   0.0071786    0.022001    0.065497     0.94899   0.0015057]
[   0.013181   0.0071786    0.022001    0.065497     0.95242   0.0015057]
[   0.013181   0.0071786    0.022001    0.065497     0.95752   0.0015057]
./test\36.avi
scerario
[    0.24287     0.14472     0.55805    0.077078   0.0051512]
[    0.32203      0.1602     0.55805     0.10802   0.0075118]
[    0.32203      0.1602      0.7836     0.10802   0.0075118]
[    0.47266      0.1602      0.7836     0.10802   0.0075118]
[    0.47266      0.1602      0.7836     0.10802   0.0075118]
[    0.51701      0.1602      0.7836     0.10802   0.0075118]
[    0.51701     0.22616      0.7836     0.10964   0.0075118]
[    0.51701     0.23223      0.7836     0.22553   0.0075118]
[    0.51701     0.23223      0.7836     0.22553   0.0075118]
weather
[   0.083531     0.49267     0.27088     0.15269   0.0038453    0.034693]
[   0.094409     0.49267     0.27088     0.21874   0.0052975    0.065117]
[    0.10453     0.49267     0.27088     0.23267   0.0052975    0.065117]
[    0.10453     0.49267     0.27088     0.33079    0.016912    0.065117]
[    0.10453     0.49267     0.27088     0.46853    0.016912    0.065117]
[    0.10453     0.49267     0.27088     0.46853    0.016912    0.065117]
[    0.10453     0.49267     0.27088     0.46853    0.016912    0.065117]
[    0.14152     0.49267     0.27088     0.46853    0.016912    0.065117]
[    0.14152     0.49267     0.27088     0.46853    0.016912    0.065117]
./test\39.avi
scerario
[    0.23102     0.41556     0.47047     0.18194   0.0026481]
[    0.38142     0.41556     0.47047     0.18194   0.0026481]
[    0.38142     0.41556     0.47047     0.18194   0.0083986]
[    0.38142     0.41556     0.47047     0.64965   0.0083986]
[    0.38142     0.41556     0.47047     0.64965   0.0083986]
[    0.38142     0.41556     0.47047     0.87291   0.0083986]
[    0.38142     0.41556     0.47047     0.87291   0.0083986]
[    0.38142     0.41556     0.47047     0.87291   0.0083986]
[    0.38142     0.41556     0.65922     0.87291   0.0083986]
weather
[    0.61101    0.085584    0.060036     0.22442     0.03278    0.097601]
[    0.61101    0.093784    0.060036     0.22442     0.03278    0.097601]
[    0.61101     0.11225    0.060036     0.22442     0.03278     0.11354]
[    0.61101     0.15785    0.060036     0.22442     0.03278     0.13029]
[    0.61101     0.15785    0.060036     0.24566    0.034656     0.13029]
[    0.61101     0.16172    0.062746     0.34735     0.03693     0.13029]
[    0.61101     0.16172    0.071438     0.34735     0.03693     0.13029]
[    0.61101     0.16172    0.080104     0.34735     0.03693     0.13029]
[    0.61101     0.16172    0.086038     0.34735     0.03693     0.13029]
./test\40.avi
scerario
[    0.23096     0.10074     0.69078     0.34762   0.0026065]
[     0.2332     0.10074     0.69078     0.55691   0.0027993]
[    0.26059     0.10074     0.69078     0.55691   0.0059061]
[    0.37208      0.1346     0.69078     0.55691   0.0059061]
[    0.50756      0.1346     0.69078     0.55691   0.0059061]
[    0.50756      0.1346     0.69078     0.56006   0.0059061]
[    0.50756      0.1346     0.69078     0.75561   0.0059061]
[    0.50756      0.1346     0.69078     0.75561   0.0059061]
[    0.50756      0.1346     0.69078     0.75561   0.0059061]
weather
[   0.056989     0.25613      0.4845     0.20756   0.0024822    0.032743]
[   0.056989     0.30462      0.4845     0.20756   0.0024822    0.032743]
[   0.056989     0.30462     0.54479     0.20756   0.0032443    0.032743]
[   0.056989     0.30462     0.55229     0.20756   0.0032443    0.032743]
[   0.056989     0.30462     0.55229     0.20756   0.0032443    0.032743]
[   0.056989     0.30462     0.61629     0.20756    0.003481    0.035315]
[   0.056989     0.30462     0.61629     0.20756    0.003481    0.035315]
[   0.083436     0.30462     0.61629     0.20756   0.0059242    0.035315]
[   0.083436     0.30462     0.66153     0.20756   0.0059242    0.035315]
./test\41.avi
scerario
[  0.0089681     0.16718     0.80949    0.030156   0.0014334]
[  0.0089681     0.17717     0.80949    0.030156   0.0014334]
[  0.0089681     0.17717     0.89305    0.030156   0.0014334]
[  0.0089681     0.21459     0.89305    0.030156   0.0014334]
[  0.0089681     0.21459     0.89305    0.030156   0.0014334]
[  0.0089681     0.21459     0.89305    0.030156   0.0014334]
[   0.012319     0.33028     0.89305    0.030156   0.0038073]
[   0.023606     0.33028     0.89305    0.037416   0.0038073]
[   0.023606     0.33028     0.89305    0.037416   0.0038073]
weather
[    0.15969     0.28787     0.21483     0.36087   0.0049452    0.049873]
[    0.15969     0.28787     0.22443     0.36465   0.0049452    0.049873]
[    0.19834     0.28787     0.22443     0.36465   0.0049452    0.049873]
[    0.21634     0.28787     0.22443     0.37373   0.0049452    0.049873]
[    0.21634     0.28787     0.23712     0.37373   0.0049452    0.068509]
[    0.26173     0.28787     0.23712     0.37373   0.0049452    0.068509]
[    0.26173     0.28787     0.29696     0.37373   0.0058484    0.068509]
[    0.26173     0.28787     0.29696     0.37373   0.0058484    0.068509]
[    0.26173     0.28787     0.29696     0.37373   0.0068428     0.10139]
./test\42.avi
scerario
[  0.0042098     0.24843     0.79351    0.011392   0.0004361]
[  0.0042098     0.24843     0.79351    0.011392   0.0004361]
[  0.0048368     0.28123     0.79351    0.011392  0.00096528]
[  0.0048368     0.28123     0.86647    0.011392  0.00096528]
[  0.0048368     0.28123     0.86782    0.011392  0.00096528]
[  0.0048368     0.28123     0.86782    0.011502  0.00096528]
[  0.0052262     0.28123     0.86782    0.013281  0.00096528]
[   0.011328     0.37901     0.86782     0.43983    0.013078]
[   0.014063      0.4384     0.86782     0.43983    0.013078]
weather
[    0.26115     0.21326     0.21325     0.33165   0.0044194    0.053425]
[    0.26115     0.21326     0.21325      0.4152   0.0044194    0.053425]
[    0.26509     0.21601     0.21325      0.4152   0.0057989     0.07743]
[    0.36594     0.21601     0.21325      0.4152   0.0057989     0.07743]
[    0.36594     0.21601     0.21325      0.4152   0.0057989     0.07743]
[    0.36594     0.21601     0.27139      0.4152   0.0057989     0.07743]
[    0.36594     0.21601     0.27139      0.4152   0.0057989     0.07743]
[    0.36594     0.29903     0.27139      0.4152    0.014278     0.12636]
[    0.36594     0.29903     0.27139      0.4152    0.014278     0.12636]
./test\43.avi
scerario
[   0.086368    0.084434     0.77098      0.1925   0.0090546]
[    0.11168    0.094677     0.77098     0.25847    0.010371]
[    0.13431     0.14266     0.77098     0.29255    0.017158]
[    0.13431     0.14266     0.77098     0.29255    0.017158]
[    0.13431     0.16644     0.77098      0.3489    0.023241]
[    0.13431     0.16644     0.77098      0.3489    0.026001]
[    0.13431     0.16644     0.85523      0.3489    0.026001]
[    0.13431     0.16644     0.87311      0.3489    0.026001]
[    0.15003     0.16644     0.87311      0.3489    0.026001]
weather
[    0.30413     0.21822    0.067711     0.33991   0.0077104     0.20874]
[    0.30413     0.28361    0.088475     0.33991   0.0077104     0.20874]
[    0.30413     0.28361    0.088475      0.3561   0.0077104     0.20874]
[     0.3254     0.28361    0.088475      0.3561   0.0077104     0.20874]
[    0.33174     0.28361    0.088475      0.3561   0.0077104     0.22629]
[    0.43758     0.28361    0.088475      0.3561   0.0077104     0.22629]
[    0.56374     0.28361    0.088475      0.3561   0.0077104     0.22629]
[    0.56374     0.28361    0.088475     0.37012   0.0077104     0.22629]
[    0.56374     0.28361    0.088475     0.37012   0.0077104     0.22629]
./test\44.avi
scerario
[   0.049283     0.21021     0.25864     0.69031    0.010851]
[   0.049283     0.22563     0.29091     0.69031    0.010851]
[   0.049283     0.22563     0.59513     0.69031    0.015909]
[   0.049283     0.22563     0.59513     0.69031    0.015909]
[   0.049283     0.22563     0.59513     0.69031    0.015909]
[   0.049283     0.22563     0.83394     0.69031    0.015909]
[   0.049283     0.22563     0.89204     0.69031    0.015909]
[   0.049283     0.22563     0.92543     0.69031    0.015909]
[   0.049283     0.22563     0.92543     0.69031    0.015909]
weather
[    0.67832     0.13933    0.053878     0.12784    0.016405     0.13654]
[    0.67832     0.14807    0.083852     0.12784    0.016405     0.35519]
[    0.67832     0.14807    0.083852     0.12784    0.016405     0.35519]
[    0.67832     0.14807    0.083852     0.12784    0.016405     0.35519]
[    0.67832     0.14807    0.083852     0.12784    0.016405     0.35519]
[    0.67832      0.1562    0.083852     0.12784    0.016405     0.35519]
[    0.74382      0.1562    0.083852     0.12784    0.016405     0.35519]
[    0.74382      0.1562    0.083852     0.12784    0.016405     0.35519]
[    0.74382      0.1562    0.083852     0.12784    0.016405     0.35519]
./test\45.avi
scerario
[   0.034383     0.56738     0.60531    0.044705   0.0011384]
[   0.034383     0.56738     0.60531    0.063394   0.0012493]
[   0.039716     0.56738     0.60531    0.090931   0.0013891]
[   0.054337     0.56738     0.60531     0.10002   0.0021574]
[   0.054337     0.56738     0.60531     0.10002   0.0034264]
[   0.054337     0.56738     0.60531     0.10002   0.0034264]
[   0.080935     0.56738     0.60531     0.14068     0.01353]
[   0.080935     0.56738     0.60531     0.14068     0.01353]
[   0.080935     0.56738     0.60531     0.14068     0.01353]
weather
[     0.3698    0.095893     0.33473     0.27898   0.0061571      0.1047]
[    0.43136     0.10442     0.33473     0.27898   0.0061571      0.1047]
[    0.47987     0.11059     0.33473     0.27898   0.0061571      0.1047]
[    0.47987     0.12152     0.33473     0.27898   0.0076772      0.1047]
[    0.48269     0.12152     0.33473     0.27898   0.0076772      0.1047]
[    0.48269     0.19349     0.34109     0.27898   0.0092417      0.1047]
[    0.48269     0.19349     0.34109     0.27898    0.031799     0.10478]
[    0.48269     0.19349     0.34109     0.43081    0.031799      0.1176]
[    0.48269     0.19349     0.34109     0.43081    0.031799     0.18984]
./test\46.avi
scerario
[   0.053978    0.062252     0.88307    0.011052    0.001073]
[    0.14246     0.14094     0.88307     0.02429   0.0012769]
[    0.14246     0.14094     0.88307     0.02429   0.0038113]
[    0.14246     0.14094     0.88307     0.02429   0.0038113]
[    0.14246     0.14094     0.89183     0.02429   0.0038113]
[    0.14246     0.14094     0.94832     0.02429   0.0038113]
[    0.14246     0.23082     0.94832     0.02798   0.0038113]
[    0.14246     0.48027     0.94832     0.22986    0.017598]
[    0.14246     0.48027     0.94832     0.22986    0.017598]
weather
[  0.0035985    0.026056    0.033108     0.95556   0.0003532  0.00095147]
[  0.0035985    0.026056    0.033108     0.96938   0.0003532  0.00095147]
[  0.0035985    0.026056    0.033108     0.96938  0.00045755   0.0013656]
[  0.0038395    0.026056    0.033108     0.96938  0.00045755   0.0014168]
[  0.0080166    0.026056    0.033108     0.96938  0.00045755   0.0020825]
[  0.0097497    0.026056    0.033108     0.96938  0.00053206   0.0023008]
[  0.0097497    0.026056    0.033108     0.96938  0.00053206   0.0023008]
[  0.0097497    0.026056    0.033108     0.98688  0.00053206   0.0023008]
[  0.0097497    0.026056    0.033108     0.98688  0.00053206   0.0023008]
./test\47.avi
scerario
[   0.073186     0.13114     0.66644     0.25354    0.015728]
[    0.10245     0.14834     0.66644     0.25354    0.015728]
[    0.13257     0.15093     0.66644     0.25354    0.015728]
[    0.13257     0.17034     0.66644     0.25354    0.015728]
[    0.13257     0.17034     0.82794     0.25354    0.015728]
[    0.13257     0.17034     0.82794     0.25354    0.015728]
[    0.13257     0.17034     0.82794     0.25354    0.015728]
[    0.13257     0.39798     0.82794     0.25354    0.015728]
[    0.13257     0.39798     0.82794     0.25354    0.015728]
weather
[    0.36332    0.025413     0.10266     0.38981   0.0065103     0.14104]
[    0.36332    0.047334     0.32684     0.38981   0.0089438     0.14104]
[    0.36332    0.047334     0.35285     0.38981   0.0089438     0.14104]
[    0.36332    0.047334     0.35285     0.38981   0.0089438     0.15706]
[    0.36342    0.047334     0.35285     0.38981   0.0089438      0.2105]
[    0.45139    0.047334     0.35285     0.38981   0.0089438      0.2105]
[    0.45139    0.047334      0.4968     0.38981   0.0089438      0.2105]
[    0.45139    0.083182      0.4968     0.38981   0.0089438      0.2105]
[    0.45139    0.083182     0.74185     0.38981   0.0089438      0.2105]
./test\48.avi
scerario
[   0.069606    0.070064     0.89931     0.03742   0.0049336]
[    0.10895     0.19338     0.89931    0.051161   0.0049336]
[    0.11449     0.25288     0.89931     0.14735   0.0067561]
[    0.11449     0.43358     0.89931     0.15472   0.0067561]
[    0.11933     0.43358     0.89931     0.15472   0.0067561]
[    0.18142     0.43358     0.89931     0.15472   0.0067561]
[    0.18142     0.43358     0.89931     0.15472   0.0077772]
[    0.18267     0.43358     0.89931      0.2235   0.0077772]
[    0.18267     0.43358     0.89931      0.2235   0.0078922]
weather
[    0.43152    0.039717     0.50181     0.28107   0.0032547     0.12102]
[    0.43152    0.039717     0.50181      0.2893   0.0032547     0.12102]
[    0.51479    0.039717     0.50181      0.2893   0.0061719     0.12102]
[    0.51479    0.039717     0.50423      0.2893    0.011352     0.12102]
[    0.51479    0.039717     0.50423     0.31305    0.011352     0.12102]
[    0.51479    0.039717     0.50423     0.36815    0.011352     0.12102]
[    0.51479    0.039717     0.50423     0.49582    0.011352     0.12102]
[    0.51479    0.039717     0.50423     0.49582    0.011352     0.12102]
[    0.51479    0.039717     0.50423     0.49582    0.015339     0.12102]
./test\49.avi
scerario
[    0.30543     0.30877     0.43256     0.17318   0.0069974]
[    0.30543     0.30877     0.66928     0.17318   0.0070626]
[    0.30543     0.30877     0.72109     0.17318   0.0076439]
[    0.32387     0.30877     0.72109     0.17318    0.010302]
[    0.32387     0.30877     0.88155     0.17318    0.010302]
[    0.32387     0.30877     0.88155     0.17318    0.010302]
[    0.32387     0.30877     0.88155     0.17318    0.010302]
[    0.32387     0.30877     0.88155     0.17318    0.010302]
[    0.32387     0.30877     0.88155     0.17318    0.010302]
weather
[   0.011763    0.011641      0.1268     0.92587   0.0019088   0.0040166]
[   0.015247    0.013343     0.14719     0.92587   0.0019088   0.0071839]
[   0.029257    0.027812     0.23245     0.92587   0.0044469    0.011521]
[   0.029257    0.027812     0.23245     0.92587   0.0044469    0.011521]
[   0.029257    0.027812     0.23245     0.92587   0.0044469    0.024152]
[   0.029257    0.027812     0.23245     0.92587   0.0044469    0.048206]
[   0.029257    0.027812     0.23245     0.93115   0.0044469    0.048206]
[   0.029257    0.027812     0.23245     0.93115   0.0044469    0.048206]
[   0.029257    0.027812     0.23245     0.93115   0.0044469    0.048206]
./test\50.avi
scerario
[   0.061343     0.15069     0.90249    0.039975   0.0050425]
[   0.084484     0.22758     0.90249     0.07942   0.0050425]
[   0.084484     0.22758     0.90249     0.07942   0.0062486]
[   0.084484     0.37955     0.90249     0.11301    0.020633]
[   0.084484     0.37955     0.90249     0.11301    0.020633]
[   0.099697     0.37955     0.90249     0.11301    0.020633]
[   0.099697     0.37955     0.90249     0.11301    0.020633]
[    0.13634     0.38924     0.90249     0.12805    0.020633]
[    0.13634     0.38924     0.90249     0.12805    0.020633]
weather
[   0.024692    0.011356     0.96051    0.019819   0.0057563   0.0015175]
[   0.024692    0.011356     0.97395    0.019819   0.0057563   0.0015175]
[   0.024692    0.011356     0.97501    0.019819   0.0057563   0.0015175]
[   0.024692    0.011356     0.97501    0.019819   0.0057563   0.0019449]
[   0.024692    0.011356     0.97501    0.020809   0.0057563   0.0019449]
[   0.024692    0.011356     0.97501    0.024176   0.0057563   0.0019449]
[   0.024692    0.011356     0.97501    0.028452   0.0057563   0.0019449]
[   0.024692    0.011356     0.97843    0.028452   0.0057563   0.0019449]
[   0.024692    0.011356     0.97949    0.028452   0.0057563   0.0019449]
./test\61.mp4
scerario
[  0.0035858   0.0017611   0.0078895     0.98772  0.00016879]
[  0.0036851   0.0017611   0.0078895     0.98772  0.00017943]
[  0.0048981   0.0022717    0.025062     0.98772  0.00023341]
[   0.005792   0.0046844    0.035829     0.98772  0.00068222]
[   0.005792   0.0046844    0.035829     0.99267  0.00068222]
[   0.005792   0.0046844    0.035829     0.99484  0.00068222]
[   0.005792   0.0046844    0.035829     0.99515  0.00068222]
[   0.005792   0.0046844    0.035829     0.99627  0.00068222]
[   0.005792   0.0046844    0.035829     0.99627  0.00068222]
weather
[    0.28289    0.095088      0.6654     0.16203    0.016886    0.023995]
[    0.33281     0.11562      0.6654     0.19188    0.016886    0.069642]
[    0.33281     0.11711      0.6654     0.19188    0.016886    0.069642]
[    0.33281     0.11711     0.75148     0.19188    0.016886    0.069642]
[    0.33281     0.11711     0.77824     0.19188    0.016886    0.069642]
[    0.33281     0.11711     0.77824     0.19188    0.016886    0.069642]
[    0.33281     0.11711     0.77824     0.19188    0.016886    0.069642]
[    0.33281     0.11711     0.77824     0.19188    0.016886    0.069642]
[    0.33281     0.11711     0.77824     0.19188    0.016886    0.069642]
./test\62.mp4
scerario
[  0.0016103   0.0016017   0.0023639     0.99489   0.0004477]
[  0.0020895   0.0033328   0.0051503     0.99489   0.0011666]
[  0.0020895   0.0033328   0.0054348     0.99489   0.0011666]
[  0.0037733   0.0033328   0.0085093     0.99489    0.001197]
[  0.0086996   0.0033328    0.015824     0.99489    0.001524]
[  0.0086996   0.0033328    0.015824     0.99489    0.001524]
[  0.0086996   0.0033328    0.015824     0.99489    0.001524]
[  0.0086996   0.0033328    0.015824     0.99489    0.001524]
[  0.0086996   0.0033328    0.015824     0.99489    0.001524]
weather
[    0.15235     0.10091     0.56869     0.21851    0.015366    0.060173]
[    0.29193     0.10091     0.56869     0.28269    0.015366    0.088197]
[    0.29193     0.10091     0.56869     0.28269    0.015366    0.088197]
[    0.29193     0.10091     0.56869     0.28269    0.016293     0.10508]
[    0.30299     0.10091     0.56869     0.28269    0.043661     0.10508]
[    0.30299     0.10091     0.56869     0.28269    0.043661     0.10508]
[    0.30299     0.10091     0.84438     0.28269    0.043661     0.10508]
[    0.30299     0.10091     0.84438     0.28269    0.043661     0.10508]
[    0.42101     0.10091     0.84438     0.28269    0.043661     0.10508]
./test\63.mp4
scerario
[  0.0061133   0.0026626    0.016573     0.97857  0.00026952]
[  0.0097626   0.0041806    0.049074     0.97857  0.00057813]
[  0.0097626   0.0041806    0.049074     0.97857  0.00057813]
[  0.0097626   0.0043493    0.049074     0.97857  0.00064422]
[  0.0097626   0.0043493    0.049074     0.98871  0.00064422]
[  0.0097626   0.0043493    0.049074     0.99647  0.00064422]
[  0.0097626   0.0043493    0.049074     0.99647  0.00064422]
[  0.0097626   0.0043493    0.049074     0.99647  0.00089766]
[  0.0097626    0.006953    0.049074     0.99647  0.00089766]
weather
[    0.38439     0.12938     0.29723     0.20436     0.01132    0.076669]
[    0.43086     0.12938     0.33987     0.20436     0.01132    0.076669]
[    0.43086     0.12938     0.71603     0.20436     0.01132    0.076669]
[    0.43086     0.12938     0.76179     0.20436     0.01132    0.076669]
[    0.43086     0.12938     0.76179     0.20436     0.01132    0.076669]
[    0.43086     0.12938     0.76179     0.20436     0.01132    0.076669]
[    0.43086     0.12938     0.76179     0.21957     0.02154    0.076669]
[    0.43086     0.12938     0.76179     0.21957    0.050871      0.1044]
[    0.43086     0.13425     0.76179     0.32394    0.068693      0.1044]
./test\64.mp4
scerario
[  0.0036114   0.0016828    0.020556     0.98871  0.00028454]
[  0.0036114   0.0016828    0.020556     0.98871    0.000374]
[    0.00518   0.0029086    0.020556     0.98871  0.00045754]
[    0.00518   0.0033126    0.025961     0.98871  0.00045754]
[    0.00518   0.0033126    0.025961     0.98871  0.00050836]
[    0.00518   0.0061496    0.035391     0.98871  0.00050836]
[    0.00518   0.0061496    0.035391     0.98871  0.00050836]
[    0.00518   0.0061496    0.035391      0.9888  0.00050836]
[    0.00518   0.0061496    0.035391      0.9951  0.00050836]
weather
[    0.33245    0.062824     0.61649     0.16167   0.0061289     0.08906]
[    0.33245      0.0651     0.63019     0.16167   0.0061289     0.08906]
[    0.33245      0.0651     0.82499     0.16167   0.0061289     0.08906]
[    0.33245      0.0651     0.82499     0.16167   0.0085975     0.08906]
[    0.41434      0.0651     0.82499     0.16167   0.0099124     0.08906]
[    0.42949      0.0651     0.82499     0.16167    0.011503     0.08906]
[    0.42949    0.095593     0.82499     0.28685    0.014215     0.08906]
[    0.42949    0.095593     0.82499     0.34999    0.035616     0.08906]
[    0.42949    0.095593     0.82499     0.34999    0.035616     0.08906]

Process finished with exit code 0


'''